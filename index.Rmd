---
title: "Exploratory Analysis"
output: html_document
---

## EMS Response Times and Traffic Fatalities

### Authors

Eric Shi
Cecelia Deng
Tyler Ramos
Caleb Lykken

### Date
2/20/2023

Winter 2022

### Abstract

Our main question is how does the emergency response time relate to the rate of fatalities? This question is important because it is useful information for public safety. To address the question, we will create data visualizations to easily show the relationship between emergency response times and the fatality rate. We will find correlations that could help people stay safer on the public roads.

### Keywords

Traffic Fatalities, Emergency Response, Day of the Week, Weather

### Introduction  


We are going to analyze the traffic fatalities in our group project. We will create some data visualization to help people compare and contrast data. Here are some examples of questions that our project can answer.

- Which day in the week that most traffic accidents happen?
- In what weather do the most traffic accidents happen?
- How does the emergency response time relate to the death rate of fatalities?
- In which state do most traffic accidents happen?
- How can people drive more safely under specific conditions?

A vast number of people each year lose their lives due to traffic fatalities. We aim to create a tool to help people get more information about traffic accidents. By properly visualizing the data from the dataset, people can get a clearer view of traffic fatalities around them. With these data, they can avoid some high-risk driving conditions which might easily cause dangerous accidents. Also, we wish that our website could call for the public's attention. More concerns should be drawn to this part as the death number is huge. Moreover, it is the government's responsibility that they should carry out some new policies or improvements which can reduce the rate of traffic fatalities. Overall, our project is to help people understand traffic fatalities more deeply. 

### Related Work  

In this project we are planning on using the data for the response time of emergency medical services(EMS). The main goal of EMS is to provide prompt medical care and transport to a medical facility. The response time of EMS is a critical factor in determining the outcome of a medical emergency. According to the National Fire Protection Association (NFPA) Standard 1710, the goal is to arrive on scene within 5 minutes, 90% of the time. In this case NFPA is using data from the District of Columbia in order to assess how fast the EMS response time is. (source 2)
Research has shown that response time can vary depending on the location of the medical emergency. In urban areas, the average response time is often shorter compared to rural and suburban areas due to the higher concentration of medical resources. However, in rural areas, the response time may be longer due to the lower population density and longer distances between the emergency scene and the nearest medical facility. A study conducted by JAMA Surgery found that rural EMS response times were longer than those in urban and suburban areas. The study concluded that it is important for rural areas to have a well-coordinated and well-equipped EMS system to provide prompt medical care and transport to those in need. The results of this study highlight the importance of continuous improvement and investment in EMS systems to ensure that all individuals have access to timely medical care.(source 3)
Finally for Source 1 they talk more about EMS times in King County and overall emergency service related things such as the type of calls and they also check what percent arrives before certain time thresholds. 
Overall, the response time of EMS is a crucial factor in determining the outcome of a medical emergency and should be continuously monitored and improved. Investing in and improving EMS systems is essential in ensuring that all individuals have access to prompt medical care during medical emergencies.

Annotations: 
“Emergency Medical Services (EMS).” Emergency Medical Services (EMS) - King County,https://kingcounty.gov/~/media/depts/health/emergency-medical-services/documents/reports/2022-EMS-Annual-Report.ashx?la=en
“Ems Response Time.” EMS Response Time, https://fems.dc.gov/page/ems-response-time#:~:text=NFPA%20Standard%201710%20establishes%20a,17%20for%20a%20detailed%20description). 
Mell, Howard K, et al. “Emergency Medical Services Response Times in Rural, Suburban, and Urban Areas.” JAMA Surgery, U.S. National Library of Medicine, 1 Oct. 2017, https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5831456/. 

### The Dataset


We found the 2015 traffic fatalities data data from Kaggle [2015 Traffic Fatalities](https://www.kaggle.com/datasets/nhtsa/2015-traffic-fatalities) but it originally came from the [U.S. Department of Transportation](https://www.transportation.gov/briefing-room/traffic-fatalities-sharply-2015administration)
The national highway traffic safety collected this data.
They generate their data by using a scoring method that comes from a [interim identification and prioritization process](https://www.transportation.gov/mission/open/datagov-interim-identification-prioritization-process-and-guidelines-v10). 
The department of transportation collected this data to help find ways to prevent these tragedies. They made it available to the public so that researchers and data scientists could make solutions to the mass amount of fatalities that happen due to car crashes. There are 32166 observations in the data. The observations cover most of the crashes that happened in 2015 in all of the states including territories of the united states. There are 52 features in the data, the features include the state , time city and exact coordinates of the accident, it also has a lot of specific information about what happened when the crash happened. Most importantly they have the time it took for an ambulance to arrive to the site after they were notified. We will be focusing on the EMS response we need to keep an eye out for any injustice that is recorded in this dataset. Possible limitations in this data set are they don't give the exact details about the people in the crash, like their background or where they were going. These details could fill many gaps in the dataset. They are not available because the department of transportation decided to keep the identity’s of the victims anonymous.

### Implications

For technologists, the emergency response time is an opportunity to create and implement more efficient systems for dispatch and communication between first responders, hospitals, and patients. This can involve developing new technologies, such as mobile apps and real-time location tracking systems, to improve the speed and accuracy of emergency response.

For designers, the emergency response time is an important consideration when designing and implementing public safety infrastructure, such as emergency call centers, road networks, and urban planning. The goal is to ensure that emergency services can reach patients in a timely manner and provide the necessary care.

For policymakers, research on emergency response time can inform the development of policies and regulations aimed at improving emergency response times. This could include minimum response time standards, investment in emergency services and infrastructure, and policies to address issues such as traffic congestion and emergency personnel shortages. By understanding the factors that contribute to emergency response times, policymakers can make data-driven decisions to improve the effectiveness of emergency services and ensure that patients receive the care they need in a timely manner. Additionally, they may also create regulations and standards to ensure a minimum level of response time and quality of care for patients.

### Summary Information

Write a summary paragraph of findings that includes the 5 values calculated from your summary information R script
```{r, warning=F, message=F}
# Packages
library(dplyr)
library(tidyr)
library(ggplot2)

# Read dataset
Dt <- read.csv('accident.csv')
head(Dt)

# Factor for categorical variables
## STATE
States <- read.csv('States.csv')
Dt <- left_join(Dt, States, by = 'STATE')
## WEATHER
Weather <- read.csv('weather.csv')
Dt <- left_join(Dt, Weather, by = 'WEATHER1')

# Extract columns
Variable <- c('States', "DAY", "MONTH", 'YEAR', 'DAY_WEEK','LATITUDE','LONGITUD','Weather','ARR_HOUR','ARR_MIN','DRUNK_DR')
Dt.Table <- Dt[, Variable]
head(Dt.Table)

## Number_of_Cases_Stratified_Weather
summary_info <- list()
summary_info$'Number_of_Cases_Stratified_Weather' <- Dt.Table %>% group_by(States) %>% select(States, Weather) %>% table()

## Rank_of_Cases
Rank_of_Cases <- Dt.Table %>% group_by(States) %>% select(States) %>% count()
Rank_of_Cases <- Rank_of_Cases[order(Rank_of_Cases$n, decreasing = T), ]
summary_info$'Rank_of_Cases' <- Rank_of_Cases

## Max cases of accidents
summary_info$'Number_of_Cases_in_Each_Week'<- Dt.Table %>% select(DAY_WEEK) %>% table()

## Case involved drunk driver
summary_info$'Case_involved_Drunk_Driver' <- Dt.Table %>% group_by(States) %>% filter(DRUNK_DR != 0) %>% select(States) %>% count()

## Average arrival time
Dt.Table$ARR_MIN <- ifelse(Dt.Table$ARR_MIN < 60, Dt.Table$ARR_MIN / 60 , NA)
Dt.Table$ARR_HOUR <- ifelse(Dt.Table$ARR_HOUR < 24, Dt.Table$ARR_HOUR, NA)
Dt.Table$'EMS_Arrival_Time' <- round(Dt.Table$ARR_HOUR + Dt.Table$ARR_MIN, 2)
summary_info$'Average_Arrival_Time_for_Each_State' <- Dt.Table %>% select(States, EMS_Arrival_Time) %>% group_by(States) %>% summarise(Mean = round(mean(EMS_Arrival_Time, na.rm = T), 2))

summary_info
```


### Table

Include a table of aggregate information

Describe why you included the table and what information it reveals
```{r, warning=F, message=F}
# count of cases
state_case <- table(Dt.Table$States, useNA = 'ifany')
State.Name <- names(state_case)
state_case <- matrix(state_case, ncol = 1, nrow = length(State.Name), dimnames = list(State.Name, 'Number_of_Cases'))
state_case <- data.frame('States' = rownames(state_case), state_case)

# case in Rain
Death_in_Rain <- Dt.Table %>% group_by(States) %>% filter(Weather == "Rain") %>% select(States) %>% count()
colnames(Death_in_Rain)[2] <- 'Number_of_Cases_in_Rainy_Day' 

Summary_Table <- left_join(state_case, Death_in_Rain, by = 'States')

# case in 2018
Case_in_2015 <- Dt.Table %>% group_by(States) %>% filter(YEAR == 2015) %>% select(States) %>% count()
colnames(Case_in_2015)[2] <- 'Number_of_Cases_in_2015' 

Summary_Table <- left_join(Summary_Table, Case_in_2015, by = 'States')

# case involved drunk driver
Case_involved_Drunk_Driver <- Dt.Table %>% group_by(States) %>% filter(DRUNK_DR != 0) %>% select(States) %>% count()
colnames(Case_involved_Drunk_Driver)[2] <- 'Number_of_Cases_involved_Drunk_Driver' 

Summary_Table <- left_join(Summary_Table, Case_involved_Drunk_Driver, by = 'States')

# Longest EMS arrival time
Longest_EMS_Arrival_Time <- Dt.Table %>% group_by(States) %>% summarise(EMS_Arrival_Time = max(EMS_Arrival_Time, na.rm = T))

Summary_Table <- left_join(Summary_Table, Longest_EMS_Arrival_Time, by = 'States')

Summary_Table

# write.csv(Dt.Table, 'Accident Dataset (Cleaned).csv')
```


### Chart 1

``````{r, echo = FALSE, code = readLines("chart1_CalebLykken.R")}
library(tidyverse)
library(plotly)
ac_data <- read.csv("accident.csv")

deaths_persons_correlation <- ggplot(ac_data, aes(PERSONS, FATALS)) + geom_point()

ggplotly(deaths_persons_correlation)
```
This chart shows the correlation between people involved in the accident and Fatalities in the accident. It looks like the correlation between the two variables are weak negative association. We can see that most crashes that had fatalities were around 1-17 people. This information could be useful if there was a correlation it could predict if there would be more fatalities in different situations.


### Chart 2

``````{r, echo = FALSE, code = readLines("chart2_QINGDENG.R")}
library(tidyverse)
library(plotly)
accident_data <- read.csv("accident.csv")

deaths_people_weather <- ggplot(data = accident_data) + 
  geom_col(mapping = aes(x = WEATHER, y = FATALS)) 

ggplotly(deaths_people_weather)
```

This is because weather conditions may have an impact on traffic accidents, which can lead to more injuries or fatalities. For example, adverse weather conditions may lead to slippery roads, poor visibility, and poor vehicle control, which may increase the risk of traffic accidents. Therefore, analyzing the link between the number of accident deaths and injuries and weather helps us to better understand the impact of weather conditions on traffic accidents and take appropriate measures to reduce the incidence of traffic accidents and decrease the number of casualties.
At the same time, through the table, we found that it is true that the weather such as cloudy and rainy weather will increase the number of deaths and injuries in accidents. However, most of the serious injuries are during clear weather, which proves that the main reason for the number of serious injuries is not the weather.




### Chart 3

``````{r, echo = FALSE, code = readLines("chart3_TylerRamos.R")}
library(ggplot2)
library(tidyverse)
states <- c('Alabama','Alaska','Arizona','Arkansas', 
            'California','Colorado','Connecticut', 'Delaware', 
            'District of Columbia','Florida','Georgia','Hawaii', 
            'Idaho','Illinois','Indiana','Iowa','Kansas', 
            'Kentucky', 'Louisiana','Maine', 'Maryland', 
            'Massachusetts','Michigan', 'Minnesota', 
            'Mississippi','Missouri','Montana','Nebraska', 
            'Nevada','New Hampshire','New Jersey','New Mexico', 
            'New York','North Carolina','North Dakota','Ohio', 
            'Oklahoma', 'Oregon','Pennsylvania','Puerto Rico', 
            'Rhode Island', 'South Carolina','South Dakota','Tennessee', 
            'Texas','Utah','Vermont','Virginia','Virgin Islands', 
            'Washington','West Virginia','Wisconsin','Wyoming')

ac_data <- read.csv("accident.csv")
#loading GSA_codes
gsa_codes <- read.csv("FRPP_GLC_-_United_States_fEB_16_20233.csv")

ac_data <- ac_data %>% mutate(States = states[STATE])
# Adding new column for all of the state names.

ac_data <- ac_data %>% mutate(States = states[STATE])

# data frame with states and total persons in accidents
states_and_persons <- ac_data %>% group_by(States) %>% summarize(sum = sum(PERSONS))
states_and_persons_clean <- na.omit(states_and_persons)

ggplot(data = states_and_persons_clean, aes(y = States, x = sum)) +
  geom_bar(stat="identity",width= 0.5, fill="steelblue") +
  theme_minimal()

```

I decided to choose this chart due to how I was curious to see the correlation between accidents and state. The chart revealed that the states with the highest amount of accidents were Virginia, Colorado and Hawaii while Georgia, Washington and Tennessee had the lowest amount of accidents. If I were to go a step further I would check the fatality rate based on state and see if I can draw a connection.
